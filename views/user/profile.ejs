<%- include("../../views/partials/user/header") %>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./user-assets/css/maind134.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">


<style>
  
  :root {
  --primary-color: #046963;
  --secondary-color: #046963;
  --background-color: #f4f7f6;
  --text-color: #333;
  --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

body {
  font-family: 'Inter', sans-serif;
  background-color: var(--background-color);
  color: var(--text-color);
  line-height: 1.6;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px;
}

.dashboard-menu {
  background-color: white;
  border-radius: 10px;
  box-shadow: var(--card-shadow);
  padding: 20px;
  margin-bottom: 300px;
}

.dashboard-menu .nav-link {
  color: var(--text-color);
  transition: all 0.3s ease;
  padding: 10px 15px;
  border-radius: 5px;
}

.dashboard-menu .nav-link:hover,
.dashboard-menu .nav-link.active {
  background-color: var(--primary-color);
  color: white;
}

.dashboard-menu .nav-link i {
  margin-right: 10px;
}

.dashboard-content .card {
  border-radius: 10px;
  box-shadow: var(--card-shadow);
  border: none;
  margin-bottom: 20px;
}

.card-green .card-header {
  background-color: var(--primary-color);
  color: white;
  padding: 15px;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
}

.card-body {
  padding: 70px;
}

.btn-success {
  background-color: var(--secondary-color);
  border: none;
  transition: transform 0.2s;
}

.btn-success:hover {
  background-color: var(--primary-color);
  transform: scale(1.05);
}

.table {
  width: 100%;
  margin-bottom: 0;
  background-color: white;
}

.table thead {
  background-color: #f8f9fa;
}

.table th, .table td {
  padding: 12px;
  vertical-align: middle;
}

address {
  font-style: normal;
  line-height: 1.5;
}

.breadcrumb {
  background-color: transparent;
  padding: 10px 0;
}

.breadcrumb a {
  color: var(--primary-color);
  text-decoration: none;
}

@media (max-width: 768px) {
  .dashboard-menu {
    margin-bottom: 20px;
  }
  
  .dashboard-menu .nav-link {
    text-align: center;
  }
}

.card-title {
    margin-bottom: .9rem;
}
/* Tab Navigation Styles */
.nav-tabs {
    border-bottom: 2px solid #eee;
    margin-bottom: 2rem;
}

.nav-tabs .nav-link {
    border: none;
    color: #666;
    font-weight: 500;
    padding: 1rem 1.5rem;
    position: relative;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link:hover {
    color: #333;
}

.nav-tabs .nav-link.active {
    color: #2563eb;
    background: transparent;
    border: none;
}

.nav-tabs .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #2563eb;
}

/* Card Styles */
.card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    margin-bottom: 2rem;
}

.card-header {
    background-color: #fff;
    border-bottom: 1px solid #eee;
    padding: 1.5rem;
}

.card-header h5 {
    color: #333;
    font-weight: 600;
    margin: 0;
}

.card-body {
    padding: 1.5rem;
}

/* Table Styles */
.table-responsive {
    margin: 0;
    border-radius: 8px;
}

.table {
    margin-bottom: 0;
    width: 100%;
}

.table thead th {
    background-color: #f8fafc;
    border-bottom: 2px solid #eee;
    color: #64748b;
    font-weight: 600;
    padding: 1rem;
    text-transform: uppercase;
    font-size: 0.875rem;
}

.table tbody td {
    border-bottom: 1px solid #eee;
    color: #333;
    padding: 1rem;
    vertical-align: middle;
}

.table tbody tr:last-child td {
    border-bottom: none;
}

/* Button Styles */
.btn-small {
    background-color: #2563eb;
    border-radius: 6px;
    color: white;
    display: inline-block;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-small:hover {
    background-color: #1d4ed8;
    color: white;
    text-decoration: none;
}

.btn-success {
    background-color: #16a34a;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 500;
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;
}

.btn-success:hover {
    background-color: #15803d;
}

/* Wallet Section Styles */
.contact-from-area {
    padding: 2rem 0;
}

.mt-90 {
    margin-top: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    color: #333;
    display: block;
    margin-bottom: 0.5rem;
}

.h3 {
    color: #2563eb;
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.h4 {
    color: #333;
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .nav-tabs .nav-link {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
    }

    .card-header {
        padding: 1rem;
    }

    .card-body {
        padding: 1rem;
    }

    .table thead th {
        font-size: 0.75rem;
        padding: 0.75rem;
    }

    .table tbody td {
        padding: 0.75rem;
        font-size: 0.875rem;
    }

    .btn-small {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
    }
}

/* Empty State Styles */
.table tbody tr td[colspan="4"] {
    color: #64748b;
    font-style: italic;
    text-align: center;
    padding: 2rem;
}

/* Profile Dropdown Styles */
.profile-dropdown {
  position: absolute;
  right: 15px;
  top: 15px;
}

.profile-dropdown .dropdown-toggle {
  background: transparent;
  border: none;
  padding: 8px;
  border-radius: 50%;
  transition: background-color 0.2s ease;
}

.profile-dropdown .dropdown-toggle:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.profile-dropdown .bi-pen {
  font-size: 1.1rem;
  color: #fff;
}

.profile-dropdown .dropdown-menu {
  min-width: 200px;
  padding: 0.5rem 0;
  margin-top: 0.5rem;
  background: white;
  border: none;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.profile-dropdown .dropdown-item {
  padding: 0.75rem 1.25rem;
  color: #333;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.2s ease;
}

.profile-dropdown .dropdown-item:hover {
  background-color: #f8f9fa;
  color: #046963;
}

.profile-dropdown .dropdown-item i {
  font-size: 1rem;
  opacity: 0.7;
}

/* Add divider between items */
.profile-dropdown .dropdown-divider {
  margin: 0.5rem 0;
  border-top: 1px solid #eee;
}

.wallet-title {
  font-size: 24px;
  font-weight: 600;
  color: #333;
  margin: 15px 0;
}

.balance-box {
  padding: 30px;
  background: #f8f9fa;
  border-radius: 12px;
}

.balance-label {
  display: block;
  font-size: 16px;
  color: #666;
  margin-bottom: 10px;
}

.balance-amount {
  font-size: 36px;
  font-weight: 600;
  margin: 0;
  color: #666;
}

.amount-highlight {
  color: #2ecc71;  /* Green color for the amount */
  font-weight: 700;
}

.form-control {
  height: 50px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 16px;
  text-align: center;
}

.form-control:focus {
  border-color: #2ecc71;
  box-shadow: none;
}

.quick-amount-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.amount-btn {
  padding: 10px 20px;
  border: 1px solid #e0e0e0;
  background: #046963;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.amount-btn:hover {
  background: #f8f9fa;
  border-color: #2ecc71;
  color: #2ecc71;
}

.btn-add-money {
  width: 100%;
  padding: 15px;
  background: #046963;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-add-money:hover {
  background: #ffffff;
  color: #2ecc71;
  border-color: #2ecc71;
}



</style>


<main class="main">
 <div class="page-header breadcrumb-wrap mb-3">
   <div class="container">
     <div class="breadcrumb">
       <a href="#" rel="nofollow">Home</a>
       <span></span> Profile <span></span> Account
     </div>
   </div>
 </div>
  <section class="pt-10 pb-10">
   <div class="container">
     <div class="row">
       <div class="col-lg-10 m-auto">
         <div class="row">
           <div class="col-md-4">
             <div class="dashboard-menu">
               <ul class="nav flex-column" role="tablist">
                 <li class="nav-item">
                   <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                     <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true">
                     <i class="fi-rs-marker mr-10"></i>My Address
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false">
                     <i class="fi-rs-shopping-bag mr-10"></i>Orders
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet Status
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet-history" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet History
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#referal" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Referals
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" href="/logout">
                     <i class="fi-rs-sign-out mr-10"></i>Logout
                   </a>
                 </li>
               </ul>
             </div>
           </div>
           <div class="col-md-8">
             <div class="tab-content dashboard-content">


               <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                 <div class="card card-green">
                   <div class="card-header">
                    <div class="card-header">
                      <div class="profile-dropdown">
                        <button class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                          <i class="bi bi-pen"></i>
                        </button>
                        <ul class="dropdown-menu">
                          <li>
                            <a class="dropdown-item" href="/changeName">
                              <i class="bi bi-person"></i>
                              Change Name
                            </a>
                          </li>
                          <li>
                            <a class="dropdown-item" href="/change-phone">
                              <i class="bi bi-phone"></i>
                              Change Phone
                            </a>
                          </li>
                          <li>
                            <a class="dropdown-item" href="/change-email">
                              <i class="bi bi-envelope"></i>
                              Change Email
                            </a>
                          </li>
                          <li class="dropdown-divider"></li>
                          <li>
                            <a class="dropdown-item" href="/change-password">
                              <i class="bi bi-lock"></i>
                              Change Password
                            </a>
                          </li>
                        </ul>
                      </div>
                      <h5 class="mb-0 text-center" style="color: #f4f7f6;">User Profile</h5>
                    </div>
                    
                   </div>
                   <div class="card-body text-center">
                     <h5 class="card-title"><%=locals.name%></h5>
                     <p class="card-text">
                       <strong>Phone:</strong><%=locals.phone%>
                     </p>
                     <p class="card-text">
                       <strong>Email:</strong><%=locals.email%>
                     </p>
                     
                   </div>
                 </div>
               </div>


               <div
                 class="tab-pane fade"
                 id="address"
                 role="tabpanel"
                 aria-labelledby="address-tab"
               >
                 <div class="row">
                
                  <%if(userAddress){%>
                    <% userAddress.address.forEach((address) => { %>

                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"><%= address.addressType%></h5>
                       </div>


                       <div class="card-body">
                         <address>

                            <%= address.name%><br/>
                            <%= address.city%><br/>
                            <%= address.landmark%><br/>
                            <%= address.state%><br/>
                         </address>
                         <p> <%= address.pincode%></p>
                         <p> <%= address.phone%></p>
                         <p> <%= address.altPhone%></p>
                      
                         <div class="d-flex justify-content-between">
                          <a href="/editAddress?id=<%= address._id || 'defaultId' %>" class="btn-small">Edit</a>
                          <a href="/deleteAddress?id=<%=address._id%>" class="btn-small" onclick="return confirm('Are you sure you want to delete the address?')">Delete</a>
                         </div>
                        
                       </div>
                     </div>
                   </div>
                   <%})%><%}else {%>
                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"></h5>
                       </div>
                       <div class="card-body">
                         <address>No address</address>
                       </div>
                     </div>
                   </div>
                   <%}%>
              
                   <div>
                     <a href="/addAddress">
                       <button class="btn btn-primary w-70">
                         Add address
                       </button>
                     </a>
                   </div>
                 </div>
               </div>


               <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                <div class="card">
                  <div class="card-header">
                    <h5 class="mb-0">Your Orders</h5>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>Order</th>
                            <th>Status</th>
                            <th>Total</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% if (locals && locals.orderHistory && locals.orderHistory.length > 0) { %>
                            <% locals.orderHistory.forEach(order => { %>
                              
                              <tr>
                                <td><%= order.orderId %></td>
                                <td><%= order.status %></td>
                                <td>₹<%= order.finalAmound %></td>
                                <td>
                                  <a href="/orderDetails?id=<%= order._id %>" class="btn-small d-block">View</a>
                                </td>
                              </tr>
                            <% }); %>
                          <% } else { %>
                            <tr>
                              <td colspan="4">No orders found.</td>
                            </tr>
                          <% } %>                          
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              


              <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                <div class="card">
                  <div class="card-header bg-white border-bottom">
                    <h3 class="text-center wallet-title">My Wallet</h3>
                  </div>
                  <div class="card-body py-5">
                    <div class="row justify-content-center">
                      <div class="col-lg-6">
                        <!-- Wallet Balance Display -->
                        <div class="balance-box text-center mb-5">
                          <span class="balance-label">Available Balance</span>
                          <h2 class="balance-amount">₹<span class="amount-highlight"><%= locals.wallet %></span></h2>
                        </div>
              
                        <!-- Add Money Form -->
                        <div class="add-money-form">
                          <form>
                            <div class="form-group mb-4">
                              <input 
                                type="number" 
                                id="walletAmount" 
                                class="form-control form-control-lg" 
                                placeholder="Enter amount to add" 
                                required
                                min="1"
                              >
                            </div>
              
                            <!-- Quick Amount Buttons -->
                            <div class="quick-amount-buttons mb-4">
                              <button type="button" class="amount-btn" onclick="document.getElementById('walletAmount').value='100'">₹100</button>
                              <button type="button" class="amount-btn" onclick="document.getElementById('walletAmount').value='500'">₹500</button>
                              <button type="button" class="amount-btn" onclick="document.getElementById('walletAmount').value='1000'">₹1000</button>
                            </div>
              
                            <button type="button" class="btn-add-money" onclick="addMoney()">
                              Add Money
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


               <div class="tab-pane fade" id="wallet-history" role="tabpanel" aria-labelledby="orders-tab">
                 <div class="card">
                   <div class="card-header">
                     <h5 class="mb-0">Wallet History</h5>
                   </div>
                   <div class="card-body">
                     <div class="table-responsive">
                       <table class="table">
                         <thead>
                           <tr>
                             <th>Date</th>
                             <th>Status</th>
                             <th>Amount</th>
                           </tr>
                         </thead>
                         <tbody>
                          <% walletHistory.forEach(history => { %>
                            <tr>
                                <td><%= history.status %></td>
                                <td><%= new Date(history.date).toLocaleString() %></td>
                                <td>₹<%= history.amount %></td>
                            </tr>
                            <% }); %>
                         </tbody>
                       </table>
                     </div>
                   </div>
                 </div>
               </div>


               <div class="tab-pane fade" id="referal" role="tabpanel" aria-labelledby="track-orders-tab">
                 <div class="card">
                   <div class="card-header">
                     <h5 class="mb-0">Referal</h5>
                   </div>
                   <div class="card-body">
                     <h6 class="mb-3">Refer your friends and earn money!</h6>
                     <p>Share this link: <strong>></strong></p>
                     <p>Earned: ₹</p>
                   </div>
                 </div>
               </div>
       </div>
     </div>
   </div>
 </section>
</main>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  function addMoney() {
    console.log("hitted");
    let amount = document.getElementById("walletAmount").value;
    
    if (!amount || amount <= 0) {
        Swal.fire({
            icon: "error",
            title: "Invalid Amount!",
            text: "Enter a valid amount.",
        });
        return;
    }

    // Send amount to backend
    fetch("/addMoney", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ total: amount })
    })
    .then(response => response.json())
    .then(data => {
        if (data.razorpay) {
            let options = {
                "key": "rzp_test_9eLxjQq9SaHWHf", // Replace with your Razorpay key
                "amount": data.order.amount,
                "currency": "INR",
                "order_id": data.order.id,
                "handler": function (response) {
                    verifyPayment(response, data.order);
                }
            };
            let rzp = new Razorpay(options);
            rzp.open();
        } else {
            Swal.fire({
                icon: "error",
                title: "Payment Failed!",
                text: "Payment initiation failed.",
            });
        }
    })
    .catch(error => {
        console.error("Error:", error);
        Swal.fire({
            icon: "error",
            title: "Error!",
            text: "Something went wrong. Please try again.",
        });
    });
}



  function verifyPayment(payment, order) {
    fetch("/verify-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
        payment_id: payment.razorpay_payment_id,
        order_id: order.id,
        signature: payment.razorpay_signature,
        amount: order.amount
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          title: 'Success!',
          text: 'Money added successfully!',
          icon: 'success',
          confirmButtonText: 'OK'
        }).then((result) => {
          if (result.isConfirmed) {
            location.reload();
          }
        });
      } else {
        Swal.fire({
          title: 'Error!',
          text: 'Payment verification failed!',
          icon: 'error',
          confirmButtonText: 'OK'
        });
      }
    })
    .catch(error => {
      console.error("Error:", error);
      Swal.fire({
        title: 'Error!',
        text: 'Something went wrong while processing your payment.',
        icon: 'error',
        confirmButtonText: 'OK'
      });
    });
}
</script>
<%- include("../../views/partials/user/footer") %>





